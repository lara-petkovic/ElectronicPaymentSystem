(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core')) :
    typeof define === 'function' && define.amd ? define('ngx-websocket', ['exports', '@angular/core'], factory) :
    (factory((global['ngx-websocket'] = {}),global.ng.core));
}(this, (function (exports,i0) { 'use strict';

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var Subscribe = (function () {
        function Subscribe(_type, _f) {
            this.type = _type;
            this.f = _f;
        }
        return Subscribe;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    /**
     * Socket class
     * each socket handles a single WebScoket Connection.
     */
    var /**
     * Socket class
     * each socket handles a single WebScoket Connection.
     */ Socket = (function () {
        function Socket(url) {
            var _this = this;
            this.url = url;
            try {
                this.websocket = new WebSocket(url);
            }
            catch (e) {
                console.error(e);
            }
            this._state = "closed";
            this._subscribes = [];
            //onOpen
            this.websocket.addEventListener("open", function (e) {
                //websocket stream start
                //websocket stream start
                _this.subscribeLoop(true);
            });
            //onError
            this.websocket.addEventListener("error", function (e) {
                console.error("websocket onError");
            });
            //onMessage
            // this._messageObservable = Observable.create((observer) => {
            //     this.websocket.addEventListener("message", (e) => {
            //         observer.next({
            //             event: e
            //         });
            //         //stream start again
            //         this.subscribeLoop(false);
            //     });
            // });
            //onMessage
            this.websocket.addEventListener("message", function (e) {
                _this._receiveData = e;
                //stream start again
                //stream start again
                _this.subscribeLoop(false);
            });
            //onClose
            this.websocket.addEventListener("close", function (e) {
                _this._state = "closed";
                console.warn("websocket onClose");
            });
        }
        /**
         * reveive data from previous handler, wouldn't block current stream.
         * @param {?} f
         * @return {?}
         */
        Socket.prototype.then = /**
         * reveive data from previous handler, wouldn't block current stream.
         * @param {?} f
         * @return {?}
         */
            function (f) {
                this._subscribes.push(new Subscribe(0, f));
                return this;
            };
        /**
         * callback funtion when websocket reveive message.
         * @param {?} f
         * @return {?}
         */
        Socket.prototype.message = /**
         * callback funtion when websocket reveive message.
         * @param {?} f
         * @return {?}
         */
            function (f) {
                this._subscribes.push(new Subscribe(1, f));
                return this;
            };
        /**
         * catch error or close state on websocket;
         * @return {?}
         */
        Socket.prototype.catch = /**
         * catch error or close state on websocket;
         * @return {?}
         */
            function () {
                return this;
            };
        /**
         * finally handler.
         * @return {?}
         */
        Socket.prototype.finally = /**
         * finally handler.
         * @return {?}
         */
            function () {
                return this;
            };
        /**
         * send message via this websocket
         * @param {?} message
         * @return {?}
         */
        Socket.prototype.send = /**
         * send message via this websocket
         * @param {?} message
         * @return {?}
         */
            function (message) {
                try {
                    this.websocket.send(message);
                }
                catch (e) {
                    console.error(e);
                }
                return this;
            };
        /**
         * close websocket
         * @return {?}
         */
        Socket.prototype.close = /**
         * close websocket
         * @return {?}
         */
            function () {
                this.websocket.close();
            };
        /**
         * traversal subscirbes set, execute action according to item's type
         * @param {?} init if subscribeLoop is the first tiem to execute, than every 'then' handler before the first message handler will be remove after execute.
         * @return {?}
         */
        Socket.prototype.subscribeLoop = /**
         * traversal subscirbes set, execute action according to item's type
         * @param {?} init if subscribeLoop is the first tiem to execute, than every 'then' handler before the first message handler will be remove after execute.
         * @return {?}
         */
            function (init) {
                for (var /** @type {?} */ i = 0, /** @type {?} */ len = this._subscribes.length; i < len; i++) {
                    var /** @type {?} */ sub = this._subscribes[i];
                    if (sub.type === 0) {
                        this._passingData = sub.f(this._passingData, this);
                        if (init === true)
                            this._subscribes[i] = new Subscribe(0, function () { });
                    }
                    if (sub.type === 1) {
                        if (init === true)
                            break;
                        // this._messageObservable.subscribe({
                        //     next(d) {
                        //         socket._passingData = sub.f((d.event.data), socket._passingData, socket, d.event);
                        //     },
                        //     error(msg) {
                        //         //call the catch handler
                        //     }
                        // });
                        this._passingData = sub.f(this._receiveData.data, this._passingData, this, this._receiveData);
                    }
                }
            };
        Object.defineProperty(Socket.prototype, "state", {
            get: /**
             * @return {?}
             */ function () {
                return this._state;
            },
            enumerable: true,
            configurable: true
        });
        return Socket;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    /**
     * this service provides multiple methods to create websocket, add callback function to websocekt or destory webscoket.
     */
    var NgxWebsocketService = (function () {
        function NgxWebsocketService() {
            this.sockets = new Map();
        }
        /**
         * @param {?} url
         * @return {?}
         */
        NgxWebsocketService.prototype.open = /**
         * @param {?} url
         * @return {?}
         */
            function (url) {
                if (!this.checkExistence(url)) {
                    var /** @type {?} */ socket = new Socket(url);
                    this.sockets.set(url, socket);
                    return socket;
                }
            };
        /**
         * @param {?} url
         * @return {?}
         */
        NgxWebsocketService.prototype.checkExistence = /**
         * @param {?} url
         * @return {?}
         */
            function (url) {
                this.sockets.forEach(function (key, value) {
                    if (key === url) {
                        //check connection state
                        console.warn("a websocket with same url has existed");
                        return true;
                    }
                });
                return false;
            };
        NgxWebsocketService.decorators = [
            { type: i0.Injectable, args: [{
                        providedIn: 'root'
                    },] },
        ];
        /** @nocollapse */
        NgxWebsocketService.ctorParameters = function () { return []; };
        /** @nocollapse */ NgxWebsocketService.ngInjectableDef = i0.defineInjectable({ factory: function NgxWebsocketService_Factory() { return new NgxWebsocketService(); }, token: NgxWebsocketService, providedIn: "root" });
        return NgxWebsocketService;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var NgxWebsocketComponent = (function () {
        function NgxWebsocketComponent(websocketService) {
            this.websocketService = websocketService;
        }
        NgxWebsocketComponent.decorators = [
            { type: i0.Component, args: [{
                        selector: 'enl-ngx-websocket',
                        template: "\n    <p>\n      ngx-websocket works!\n    </p>\n    <div>\n      <button>\u53D1\u9001</button>\n    </div>\n  ",
                        styles: []
                    },] },
        ];
        /** @nocollapse */
        NgxWebsocketComponent.ctorParameters = function () {
            return [
                { type: NgxWebsocketService }
            ];
        };
        return NgxWebsocketComponent;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */
    var NgxWebsocketModule = (function () {
        function NgxWebsocketModule() {
        }
        NgxWebsocketModule.decorators = [
            { type: i0.NgModule, args: [{
                        imports: [],
                        declarations: [NgxWebsocketComponent],
                        exports: [NgxWebsocketComponent]
                    },] },
        ];
        return NgxWebsocketModule;
    }());

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    /**
     * @fileoverview added by tsickle
     * @suppress {checkTypes} checked by tsc
     */

    exports.NgxWebsocketService = NgxWebsocketService;
    exports.NgxWebsocketComponent = NgxWebsocketComponent;
    exports.NgxWebsocketModule = NgxWebsocketModule;
    exports.Socket = Socket;

    Object.defineProperty(exports, '__esModule', { value: true });

})));

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXdlYnNvY2tldC51bWQuanMubWFwIiwic291cmNlcyI6WyJuZzovL25neC13ZWJzb2NrZXQvbGliL3N1YnNjcmliZS50cyIsIm5nOi8vbmd4LXdlYnNvY2tldC9saWIvc29ja2V0LnRzIiwibmc6Ly9uZ3gtd2Vic29ja2V0L2xpYi9uZ3gtd2Vic29ja2V0LnNlcnZpY2UudHMiLCJuZzovL25neC13ZWJzb2NrZXQvbGliL25neC13ZWJzb2NrZXQuY29tcG9uZW50LnRzIiwibmc6Ly9uZ3gtd2Vic29ja2V0L2xpYi9uZ3gtd2Vic29ja2V0Lm1vZHVsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgU3Vic2NyaWJlIHtcbiAgICBwdWJsaWMgdHlwZTogbnVtYmVyOyAvL3RoZW46IDAsIG1lc3NhZ2U6IDEsIGNhdGNoOiAyLCBmaW5hbGx5OiAzLlxuICAgIHB1YmxpYyBmOiBGdW5jdGlvbjtcbiAgICBjb25zdHJ1Y3RvcihfdHlwZTogbnVtYmVyLCBfZjogRnVuY3Rpb24pIHtcbiAgICAgICAgdGhpcy50eXBlID0gX3R5cGU7XG4gICAgICAgIHRoaXMuZiA9IF9mO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgVXRpbHMgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHsgU3Vic2NyaWJlIH0gZnJvbSBcIi4vc3Vic2NyaWJlXCI7XG4vKipcbiAqIFNvY2tldCBjbGFzc1xuICogZWFjaCBzb2NrZXQgaGFuZGxlcyBhIHNpbmdsZSBXZWJTY29rZXQgQ29ubmVjdGlvbi5cbiAqL1xuZXhwb3J0IGNsYXNzIFNvY2tldCB7XG4gICAgcHJpdmF0ZSB3ZWJzb2NrZXQ6IFdlYlNvY2tldDtcbiAgICBwcml2YXRlIF9zdGF0ZTogc3RyaW5nO1xuICAgIHByaXZhdGUgX3Bhc3NpbmdEYXRhOiBhbnk7XG4gICAgcHJpdmF0ZSBfcmVjZWl2ZURhdGE6IGFueTtcbiAgICBwcml2YXRlIF9vcGVuT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxhbnk+O1xuICAgIHByaXZhdGUgX2Vycm9yT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxhbnk+O1xuICAgIHByaXZhdGUgX21lc3NhZ2VPYnNlcnZhYmxlOiBPYnNlcnZhYmxlPGFueT47XG4gICAgcHJpdmF0ZSBfY2xvc2VPYnNlcnZhYmxlOiBPYnNlcnZhYmxlPGFueT47XG4gICAgcHJpdmF0ZSBfc3Vic2NyaWJlczogU3Vic2NyaWJlW107XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHVybDogc3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLndlYnNvY2tldCA9IG5ldyBXZWJTb2NrZXQodXJsKTtcbiAgICAgICAgfSBjYXRjaChlKSB7XG4gICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGF0ZSA9IFwiY2xvc2VkXCI7XG4gICAgICAgIHRoaXMuX3N1YnNjcmliZXMgPSBbXTtcbiAgICAgICAgLy9vbk9wZW5cbiAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm9wZW5cIiwgKGUpID0+IHtcbiAgICAgICAgICAgIC8vd2Vic29ja2V0IHN0cmVhbSBzdGFydFxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVMb29wKHRydWUpO1xuICAgICAgICB9KVxuXG4gICAgICAgIC8vb25FcnJvclxuICAgICAgICB0aGlzLndlYnNvY2tldC5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJ3ZWJzb2NrZXQgb25FcnJvclwiKTtcbiAgICAgICAgfSlcblxuICAgICAgICAvL29uTWVzc2FnZVxuICAgICAgICAvLyB0aGlzLl9tZXNzYWdlT2JzZXJ2YWJsZSA9IE9ic2VydmFibGUuY3JlYXRlKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAvLyAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGUpID0+IHtcbiAgICAgICAgLy8gICAgICAgICBvYnNlcnZlci5uZXh0KHtcbiAgICAgICAgLy8gICAgICAgICAgICAgZXZlbnQ6IGVcbiAgICAgICAgLy8gICAgICAgICB9KTtcbiAgICAgICAgLy8gICAgICAgICAvL3N0cmVhbSBzdGFydCBhZ2FpblxuICAgICAgICAvLyAgICAgICAgIHRoaXMuc3Vic2NyaWJlTG9vcChmYWxzZSk7XG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gfSk7XG5cbiAgICAgICAgLy9vbk1lc3NhZ2VcbiAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcIm1lc3NhZ2VcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVEYXRhID0gZTtcbiAgICAgICAgICAgIC8vc3RyZWFtIHN0YXJ0IGFnYWluXG4gICAgICAgICAgICB0aGlzLnN1YnNjcmliZUxvb3AoZmFsc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvL29uQ2xvc2VcbiAgICAgICAgdGhpcy53ZWJzb2NrZXQuYWRkRXZlbnRMaXN0ZW5lcihcImNsb3NlXCIsIChlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IFwiY2xvc2VkXCI7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJ3ZWJzb2NrZXQgb25DbG9zZVwiKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogcmV2ZWl2ZSBkYXRhIGZyb20gcHJldmlvdXMgaGFuZGxlciwgd291bGRuJ3QgYmxvY2sgY3VycmVudCBzdHJlYW0uXG4gICAgICogQHBhcmFtIGYgXG4gICAgICovXG4gICAgcHVibGljIHRoZW4oZjogKGQ6IGFueSwgc29ja2V0PzogU29ja2V0KSA9PiBhbnkpOiBTb2NrZXQge1xuICAgICAgICB0aGlzLl9zdWJzY3JpYmVzLnB1c2gobmV3IFN1YnNjcmliZSgwLCBmKSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNhbGxiYWNrIGZ1bnRpb24gd2hlbiB3ZWJzb2NrZXQgcmV2ZWl2ZSBtZXNzYWdlLiBcbiAgICAgKiBAcGFyYW0gZiBcbiAgICAgKi9cbiAgICBwdWJsaWMgbWVzc2FnZShmOiAodGV4dDogYW55LCBkPzogYW55LCBzb2NrZXQ/OiBTb2NrZXQsIGV2ZW50PzogRXZlbnQpID0+IGFueSk6IFNvY2tldCB7XG4gICAgICAgIHRoaXMuX3N1YnNjcmliZXMucHVzaChuZXcgU3Vic2NyaWJlKDEsIGYpKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY2F0Y2ggZXJyb3Igb3IgY2xvc2Ugc3RhdGUgb24gd2Vic29ja2V0O1xuICAgICAqL1xuICAgIHB1YmxpYyBjYXRjaCgpOiBTb2NrZXQge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBmaW5hbGx5IGhhbmRsZXIuXG4gICAgICovXG4gICAgcHVibGljIGZpbmFsbHkoKTogU29ja2V0IHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogc2VuZCBtZXNzYWdlIHZpYSB0aGlzIHdlYnNvY2tldFxuICAgICAqIEBwYXJhbSBtZXNzYWdlIFxuICAgICAqL1xuICAgIHB1YmxpYyBzZW5kKG1lc3NhZ2U6IHN0cmluZyk6IFNvY2tldCB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLndlYnNvY2tldC5zZW5kKG1lc3NhZ2UpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNsb3NlIHdlYnNvY2tldFxuICAgICAqL1xuICAgIHB1YmxpYyBjbG9zZSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy53ZWJzb2NrZXQuY2xvc2UoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB0cmF2ZXJzYWwgc3Vic2NpcmJlcyBzZXQsIGV4ZWN1dGUgYWN0aW9uIGFjY29yZGluZyB0byBpdGVtJ3MgdHlwZVxuICAgICAqIEBwYXJhbSBpbml0IGlmIHN1YnNjcmliZUxvb3AgaXMgdGhlIGZpcnN0IHRpZW0gdG8gZXhlY3V0ZSwgdGhhbiBldmVyeSAndGhlbicgaGFuZGxlciBiZWZvcmUgdGhlIGZpcnN0IG1lc3NhZ2UgaGFuZGxlciB3aWxsIGJlIHJlbW92ZSBhZnRlciBleGVjdXRlLlxuICAgICAqL1xuICAgIHB1YmxpYyBzdWJzY3JpYmVMb29wKGluaXQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX3N1YnNjcmliZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBzdWIgPSB0aGlzLl9zdWJzY3JpYmVzW2ldO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoc3ViLnR5cGUgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9wYXNzaW5nRGF0YSA9IHN1Yi5mKHRoaXMuX3Bhc3NpbmdEYXRhLCB0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5pdCA9PT0gdHJ1ZSkgdGhpcy5fc3Vic2NyaWJlc1tpXSA9IG5ldyBTdWJzY3JpYmUoMCwgKCkgPT4ge30pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1Yi50eXBlID09PSAxKSB7XG4gICAgICAgICAgICAgICAgaWYgKGluaXQgPT09IHRydWUpIGJyZWFrO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuX21lc3NhZ2VPYnNlcnZhYmxlLnN1YnNjcmliZSh7XG4gICAgICAgICAgICAgICAgLy8gICAgIG5leHQoZCkge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICAgc29ja2V0Ll9wYXNzaW5nRGF0YSA9IHN1Yi5mKChkLmV2ZW50LmRhdGEpLCBzb2NrZXQuX3Bhc3NpbmdEYXRhLCBzb2NrZXQsIGQuZXZlbnQpO1xuICAgICAgICAgICAgICAgIC8vICAgICB9LFxuICAgICAgICAgICAgICAgIC8vICAgICBlcnJvcihtc2cpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIC8vY2FsbCB0aGUgY2F0Y2ggaGFuZGxlclxuICAgICAgICAgICAgICAgIC8vICAgICB9XG4gICAgICAgICAgICAgICAgLy8gfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGFzc2luZ0RhdGEgPSBzdWIuZih0aGlzLl9yZWNlaXZlRGF0YS5kYXRhLCB0aGlzLl9wYXNzaW5nRGF0YSwgdGhpcywgdGhpcy5fcmVjZWl2ZURhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy9nZXQgc3RhdGUgcHJvcGVydHlcbiAgICBwdWJsaWMgZ2V0IHN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGU7XG4gICAgfVxuXG5cblxufSIsImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNvY2tldCB9IGZyb20gJy4vc29ja2V0JztcblxuLyoqXG4gKiB0aGlzIHNlcnZpY2UgcHJvdmlkZXMgbXVsdGlwbGUgbWV0aG9kcyB0byBjcmVhdGUgd2Vic29ja2V0LCBhZGQgY2FsbGJhY2sgZnVuY3Rpb24gdG8gd2Vic29jZWt0IG9yIGRlc3Rvcnkgd2Vic2Nva2V0LlxuICovXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBOZ3hXZWJzb2NrZXRTZXJ2aWNlIHtcbiAgLy9zYXZlIGFsbCB0aGUgc29ja2V0IG9wZW5lZCBieSB0aGlzIHNlcnZpY2VcbiAgcHJpdmF0ZSBzb2NrZXRzOiBNYXA8c3RyaW5nLCBTb2NrZXQ+O1xuICBcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zb2NrZXRzID0gbmV3IE1hcDxzdHJpbmcsIFNvY2tldD4oKTtcbiAgfVxuXG4gIHB1YmxpYyBvcGVuKHVybCk6IFNvY2tldCB7XG4gICAgaWYgKCF0aGlzLmNoZWNrRXhpc3RlbmNlKHVybCkpIHtcbiAgICAgIGxldCBzb2NrZXQgPSBuZXcgU29ja2V0KHVybCk7XG4gICAgICB0aGlzLnNvY2tldHMuc2V0KHVybCwgc29ja2V0KTtcbiAgICAgIHJldHVybiBzb2NrZXQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0V4aXN0ZW5jZSh1cmwpIHtcbiAgICB0aGlzLnNvY2tldHMuZm9yRWFjaCgoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgaWYgKGtleSA9PT0gdXJsKSB7XG4gICAgICAgIC8vY2hlY2sgY29ubmVjdGlvbiBzdGF0ZVxuICAgICAgICBjb25zb2xlLndhcm4oXCJhIHdlYnNvY2tldCB3aXRoIHNhbWUgdXJsIGhhcyBleGlzdGVkXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5neFdlYnNvY2tldFNlcnZpY2UgfSBmcm9tICcuL25neC13ZWJzb2NrZXQuc2VydmljZSc7XG5pbXBvcnQgeyBTb2NrZXQgfSBmcm9tICcuL3NvY2tldCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2VubC1uZ3gtd2Vic29ja2V0JyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8cD5cbiAgICAgIG5neC13ZWJzb2NrZXQgd29ya3MhXG4gICAgPC9wPlxuICAgIDxkaXY+XG4gICAgICA8YnV0dG9uPsOlwo/CkcOpwoDCgTwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICBgLFxuICBzdHlsZXM6IFtdXG59KVxuZXhwb3J0IGNsYXNzIE5neFdlYnNvY2tldENvbXBvbmVudCB7XG4gIHNvY2tldDogU29ja2V0O1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHdlYnNvY2tldFNlcnZpY2U6IE5neFdlYnNvY2tldFNlcnZpY2UsXG4gICAgKSB7XG4gICAgICBcbiAgICAgfVxuXG5cblxuXG59XG4iLCJpbXBvcnQgeyBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmd4V2Vic29ja2V0Q29tcG9uZW50IH0gZnJvbSAnLi9uZ3gtd2Vic29ja2V0LmNvbXBvbmVudCc7XG5cbkBOZ01vZHVsZSh7XG4gIGltcG9ydHM6IFtcbiAgXSxcbiAgZGVjbGFyYXRpb25zOiBbTmd4V2Vic29ja2V0Q29tcG9uZW50XSxcbiAgZXhwb3J0czogW05neFdlYnNvY2tldENvbXBvbmVudF1cbn0pXG5leHBvcnQgY2xhc3MgTmd4V2Vic29ja2V0TW9kdWxlIHsgfVxuIl0sIm5hbWVzIjpbIkluamVjdGFibGUiLCJDb21wb25lbnQiLCJOZ01vZHVsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztJQUFBLElBQUE7UUFHSSxtQkFBWSxLQUFhLEVBQUUsRUFBWTtZQUNuQyxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztZQUNsQixJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztTQUNmO3dCQU5MO1FBT0MsQ0FBQTs7Ozs7O0FDTEQ7Ozs7QUFLQTs7O1FBQUE7UUFXSSxnQkFBb0IsR0FBVztZQUEvQixpQkEwQ0M7WUExQ21CLFFBQUcsR0FBSCxHQUFHLENBQVE7WUFDM0IsSUFBSTtnQkFDQSxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3ZDO1lBQUMsT0FBTSxDQUFDLEVBQUU7Z0JBQ04sT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNyQjtZQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDOztZQUV0QixJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxVQUFDLENBQUM7OztnQkFFdEMsS0FBSSxDQUFDLGFBQWEs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