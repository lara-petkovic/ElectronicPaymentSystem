!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-websocket",["exports","@angular/core"],t):t(e["ngx-websocket"]={},e.ng.core)}(this,function(e,t){"use strict";var s=function(e,t){this.type=e,this.f=t},n=function(){function e(e){var t=this;this.url=e;try{this.websocket=new WebSocket(e)}catch(n){console.error(n)}this._state="closed",this._subscribes=[],this.websocket.addEventListener("open",function(e){t.subscribeLoop(!0)}),this.websocket.addEventListener("error",function(e){console.error("websocket onError")}),this.websocket.addEventListener("message",function(e){t._receiveData=e,t.subscribeLoop(!1)}),this.websocket.addEventListener("close",function(e){t._state="closed",console.warn("websocket onClose")})}return e.prototype.then=function(e){return this._subscribes.push(new s(0,e)),this},e.prototype.message=function(e){return this._subscribes.push(new s(1,e)),this},e.prototype["catch"]=function(){return this},e.prototype["finally"]=function(){return this},e.prototype.send=function(e){try{this.websocket.send(e)}catch(t){console.error(t)}return this},e.prototype.close=function(){this.websocket.close()},e.prototype.subscribeLoop=function(e){for(var t=0,n=this._subscribes.length;t<n;t++){var o=this._subscribes[t];if(0===o.type&&(this._passingData=o.f(this._passingData,this),!0===e&&(this._subscribes[t]=new s(0,function(){}))),1===o.type){if(!0===e)break;this._passingData=o.f(this._receiveData.data,this._passingData,this,this._receiveData)}}},Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),e}(),o=function(){function e(){this.sockets=new Map}return e.prototype.open=function(e){if(!this.checkExistence(e)){var t=new n(e);return this.sockets.set(e,t),t}},e.prototype.checkExistence=function(n){return this.sockets.forEach(function(e,t){if(e===n)return console.warn("a websocket with same url has existed"),!0}),!1},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),r=function(){function e(e){this.websocketService=e}return e.decorators=[{type:t.Component,args:[{selector:"enl-ngx-websocket",template:"\n    <p>\n      ngx-websocket works!\n    </p>\n    <div>\n      <button>发送</button>\n    </div>\n  ",styles:[]}]}],e.ctorParameters=function(){return[{type:o}]},e}(),i=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[],declarations:[r],exports:[r]}]}],e}();e.NgxWebsocketService=o,e.NgxWebsocketComponent=r,e.NgxWebsocketModule=i,e.Socket=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-websocket.umd.min.js.map